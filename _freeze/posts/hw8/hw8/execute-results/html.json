{
  "hash": "2c51299411c9c76bcd51fde938f209ab",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"hw8\"\nformat: html\njupyter: python3\n---\n\n::: {#48d6e943 .cell execution_count=1}\n``` {.python .cell-code}\nimport numpy as np \nimport pandas as pd\nfrom scipy.stats import chi2\nimport statsmodels.api as sm\nfrom scipy.stats import norm\nfrom sklearn.metrics import confusion_matrix\n```\n:::\n\n\n::: {#7bfec76d .cell execution_count=2}\n``` {.python .cell-code}\n#종속변수: 백혈병 세포 관측 불가 여부 (REMISS), 1이면 관측 안됨을 의미\n#독립변수:\n#골수의 세포성 (CELL)\n#골수편의 백혈구 비율 (SMEAR)\n#골수의 백혈병 세포 침투 비율 (INFIL)\n#골수 백혈병 세포의 라벨링 인덱스 (LI)\n#말초혈액의 백혈병 세포 수 (BLAST)\n#치료 시작 전 최고 체온 (TEMP)\n```\n:::\n\n\n## 문제 1. 데이터를 로드하고, 로지스틱 회귀모델을 적합하고, 회귀 표를 작성하세요.\n\n::: {#476392be .cell execution_count=3}\n``` {.python .cell-code}\n# 데이터로드\ndata=  pd.read_table('C:/Users/USER/Documents/LS빅데이터스쿨/LSbigdata-project1/data/leukemia_remission.txt', delimiter='\\t')\ndata \n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>REMISS</th>\n      <th>CELL</th>\n      <th>SMEAR</th>\n      <th>INFIL</th>\n      <th>LI</th>\n      <th>BLAST</th>\n      <th>TEMP</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>0.80</td>\n      <td>0.83</td>\n      <td>0.66</td>\n      <td>1.9</td>\n      <td>1.10</td>\n      <td>1.00</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>0.90</td>\n      <td>0.36</td>\n      <td>0.32</td>\n      <td>1.4</td>\n      <td>0.74</td>\n      <td>0.99</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0</td>\n      <td>0.80</td>\n      <td>0.88</td>\n      <td>0.70</td>\n      <td>0.8</td>\n      <td>0.18</td>\n      <td>0.98</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.87</td>\n      <td>0.87</td>\n      <td>0.7</td>\n      <td>1.05</td>\n      <td>0.99</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1</td>\n      <td>0.90</td>\n      <td>0.75</td>\n      <td>0.68</td>\n      <td>1.3</td>\n      <td>0.52</td>\n      <td>0.98</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.65</td>\n      <td>0.65</td>\n      <td>0.6</td>\n      <td>0.52</td>\n      <td>0.98</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>1</td>\n      <td>0.95</td>\n      <td>0.97</td>\n      <td>0.92</td>\n      <td>1.0</td>\n      <td>1.23</td>\n      <td>0.99</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>0</td>\n      <td>0.95</td>\n      <td>0.87</td>\n      <td>0.83</td>\n      <td>1.9</td>\n      <td>1.35</td>\n      <td>1.02</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.45</td>\n      <td>0.45</td>\n      <td>0.8</td>\n      <td>0.32</td>\n      <td>1.00</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>0</td>\n      <td>0.95</td>\n      <td>0.36</td>\n      <td>0.34</td>\n      <td>0.5</td>\n      <td>0.00</td>\n      <td>1.04</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>0</td>\n      <td>0.85</td>\n      <td>0.39</td>\n      <td>0.33</td>\n      <td>0.7</td>\n      <td>0.28</td>\n      <td>0.99</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>0</td>\n      <td>0.70</td>\n      <td>0.76</td>\n      <td>0.53</td>\n      <td>1.2</td>\n      <td>0.15</td>\n      <td>0.98</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>0</td>\n      <td>0.80</td>\n      <td>0.46</td>\n      <td>0.37</td>\n      <td>0.4</td>\n      <td>0.38</td>\n      <td>1.01</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>0</td>\n      <td>0.20</td>\n      <td>0.39</td>\n      <td>0.08</td>\n      <td>0.8</td>\n      <td>0.11</td>\n      <td>0.99</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.90</td>\n      <td>0.90</td>\n      <td>1.1</td>\n      <td>1.04</td>\n      <td>0.99</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>1</td>\n      <td>1.00</td>\n      <td>0.84</td>\n      <td>0.84</td>\n      <td>1.9</td>\n      <td>2.06</td>\n      <td>1.02</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>0</td>\n      <td>0.65</td>\n      <td>0.42</td>\n      <td>0.27</td>\n      <td>0.5</td>\n      <td>0.11</td>\n      <td>1.01</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.75</td>\n      <td>0.75</td>\n      <td>1.0</td>\n      <td>1.32</td>\n      <td>1.00</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>0</td>\n      <td>0.50</td>\n      <td>0.44</td>\n      <td>0.22</td>\n      <td>0.6</td>\n      <td>0.11</td>\n      <td>0.99</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>1</td>\n      <td>1.00</td>\n      <td>0.63</td>\n      <td>0.63</td>\n      <td>1.1</td>\n      <td>1.07</td>\n      <td>0.99</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.33</td>\n      <td>0.33</td>\n      <td>0.4</td>\n      <td>0.18</td>\n      <td>1.01</td>\n    </tr>\n    <tr>\n      <th>21</th>\n      <td>0</td>\n      <td>0.90</td>\n      <td>0.93</td>\n      <td>0.84</td>\n      <td>0.6</td>\n      <td>1.59</td>\n      <td>1.02</td>\n    </tr>\n    <tr>\n      <th>22</th>\n      <td>1</td>\n      <td>1.00</td>\n      <td>0.58</td>\n      <td>0.58</td>\n      <td>1.0</td>\n      <td>0.53</td>\n      <td>1.00</td>\n    </tr>\n    <tr>\n      <th>23</th>\n      <td>0</td>\n      <td>0.95</td>\n      <td>0.32</td>\n      <td>0.30</td>\n      <td>1.6</td>\n      <td>0.89</td>\n      <td>0.99</td>\n    </tr>\n    <tr>\n      <th>24</th>\n      <td>1</td>\n      <td>1.00</td>\n      <td>0.60</td>\n      <td>0.60</td>\n      <td>1.7</td>\n      <td>0.96</td>\n      <td>0.99</td>\n    </tr>\n    <tr>\n      <th>25</th>\n      <td>1</td>\n      <td>1.00</td>\n      <td>0.69</td>\n      <td>0.69</td>\n      <td>0.9</td>\n      <td>0.40</td>\n      <td>0.99</td>\n    </tr>\n    <tr>\n      <th>26</th>\n      <td>0</td>\n      <td>1.00</td>\n      <td>0.73</td>\n      <td>0.73</td>\n      <td>0.7</td>\n      <td>0.40</td>\n      <td>0.99</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#f6697fdd .cell execution_count=4}\n``` {.python .cell-code}\n# 로지스틱 회귀 모델 적합\nX = data[['CELL', 'SMEAR', 'INFIL', 'LI', 'BLAST', 'TEMP']]  # 독립 변수\ny = data['REMISS']  # 종속 변수 \n\nX = sm.add_constant(X)\n\nmodel = sm.Logit(y, X)\nresult = model.fit()\n\n# 회귀표 \nprint(result.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOptimization terminated successfully.\n         Current function value: 0.399886\n         Iterations 10\n                           Logit Regression Results                           \n==============================================================================\nDep. Variable:                 REMISS   No. Observations:                   27\nModel:                          Logit   Df Residuals:                       20\nMethod:                           MLE   Df Model:                            6\nDate:                Tue, 10 Sep 2024   Pseudo R-squ.:                  0.3718\nTime:                        10:36:24   Log-Likelihood:                -10.797\nconverged:                       True   LL-Null:                       -17.186\nCovariance Type:            nonrobust   LLR p-value:                   0.04670\n==============================================================================\n                 coef    std err          z      P>|z|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst         64.2581     74.965      0.857      0.391     -82.670     211.187\nCELL          30.8301     52.135      0.591      0.554     -71.353     133.013\nSMEAR         24.6863     61.526      0.401      0.688     -95.903     145.275\nINFIL        -24.9745     65.281     -0.383      0.702    -152.923     102.974\nLI             4.3605      2.658      1.641      0.101      -0.849       9.570\nBLAST         -0.0115      2.266     -0.005      0.996      -4.453       4.430\nTEMP        -100.1734     77.753     -1.288      0.198    -252.567      52.220\n==============================================================================\n\nPossibly complete quasi-separation: A fraction 0.11 of observations can be\nperfectly predicted. This might indicate that there is complete\nquasi-separation. In this case some parameters will not be identified.\n```\n:::\n:::\n\n\n##문제 2. 해당 모델은 통계적으로 유의한가요? 그 이유를 검정통계량를 사용해서 설명하시오.(유의기준 : 0.2)\n\n::: {#4e384db7 .cell execution_count=5}\n``` {.python .cell-code}\n# 회귀표 \nstat_vaule = -2*(-17.186 + 10.797)\n1-chi2.cdf(stat_vaule, df = 6)\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```\nnp.float64(0.04669995098322843)\n```\n:::\n:::\n\n\n* 0.04669995098322843, p-value가 유의수준 0.2보다 작기 때문에 유의하다.\n\n\n##문제 3. 통계적으로 유의한 변수는 몇개이며, 어느 변수 인가요?\n\n* LI, TEMP, 2개\n\n\n##문제 4. 다음 환자에 대한 오즈는 얼마인가요?\n\n::: {#e41dbbdb .cell execution_count=6}\n``` {.python .cell-code}\n#CELL (골수의 세포성): 65%\n#SMEAR (골수편의 백혈구 비율): 45%\n#INFIL (골수의 백혈병 세포 침투 비율): 55%\n#LI (골수 백혈병 세포의 라벨링 인덱스): 1.2\n#BLAST (말초혈액의 백혈병 세포 수): 1.1세포/μL\n#TEMP (치료 시작 전 최고 체온): 0.9\n```\n:::\n\n\n::: {#2761a691 .cell execution_count=7}\n``` {.python .cell-code}\nmy_odds= np.exp(64.2581 + 30.8301*0.65 + 24.6863 * 0.45 -24.9745*0.55 + 4.3605*1.2 + -0.0115*1.1 -100.1734*0.9)\nmy_odds\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```\nnp.float64(0.03817459641135519)\n```\n:::\n:::\n\n\n##문제 5. 위 환자의 혈액에서 백혈병 세포가 관측되지 않은 확률은 얼마인가요?\n\n::: {#64495463 .cell execution_count=8}\n``` {.python .cell-code}\nprobability = my_odds / (1 + my_odds)\nprobability\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\nnp.float64(0.03677088280074742)\n```\n:::\n:::\n\n\n##문제 6. TEMP 변수의 계수는 얼마이며, 해당 계수를 사용해서 TEMP 변수가 백혈병 치료에 대한 영향을 설명하시오.\n* TEMP의 계수 : -100.1734\n* TEMP가 1 단위 증가할 때, 백혈병 세포가 관측되지 않을 오즈가 e^(-100.1734) 배 감소한다는 것을 의미 = 체온이 높아질수록 백혈병 치료 결과가 나빠질 가능성이 크다\n\n\n##문제 7. CELL 변수의 99% 오즈비에 대한 신뢰구간을 구하시오.\n\n::: {#90d29262 .cell execution_count=9}\n``` {.python .cell-code}\n# CELL 변수의 계수와 표준 오차 추출\ncell_coef = 64.2581\ncell_stderr = 74.965\n\n# 99% 신뢰구간을 위한 Z 값\nz_value = norm.ppf(1 - 0.01 / 2)\n\n# 오즈비 신뢰구간 계산\nlower_bound = np.exp(cell_coef - z_value * cell_stderr)\nupper_bound = np.exp(cell_coef + z_value * cell_stderr)\n\nprint(lower_bound, upper_bound)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n1.111623397466538e-56 5.860286060627771e+111\n```\n:::\n:::\n\n\n## 문제 8. 주어진 데이터에 대하여 로지스틱 회귀 모델의 예측 확률을 구한 후, 50% 이상인 경우 1로 처리하여, 혼동 행렬를 구하시오.\n\n::: {#6da21adb .cell execution_count=10}\n``` {.python .cell-code}\n# 예측 확률 계산\ny_pred_prob = result.predict(X)\n\n# 예측 확률을 기준으로 50% 이상은 1, 이하는 0으로 변환\ny_pred = (y_pred_prob >= 0.5).astype(int)\n\n# 혼동 행렬 계산\nconf_matrix = confusion_matrix(y, y_pred) # y:실제, y_pred: 예측\nconf_matrix\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```\narray([[15,  3],\n       [ 4,  5]])\n```\n:::\n:::\n\n\n##문제 9. 해당 모델의 Accuracy는 얼마인가요?\n\n::: {#337a372e .cell execution_count=11}\n``` {.python .cell-code}\n# 방법1\n(15+5)/(15+3+4+5)\n\n# 방밥2. 코드\nfrom sklearn.metrics import accuracy_score\naccuracy = accuracy_score(y, y_pred)\naccuracy\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```\n0.7407407407407407\n```\n:::\n:::\n\n\n##문제 10. 해당 모델의 F1 Score를 구하세요.\n\n::: {#44627763 .cell execution_count=12}\n``` {.python .cell-code}\nfrom sklearn.metrics import f1_score\nf1 = f1_score(y, y_pred)\nf1\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```\nnp.float64(0.5882352941176471)\n```\n:::\n:::\n\n\n",
    "supporting": [
      "hw8_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}